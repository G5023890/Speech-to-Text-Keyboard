#!/usr/bin/env bash
set -euo pipefail

PROJECT_DIR="/Users/grigorymordokhovich/Documents/Develop/Voice input"
HAMMERSPOON_INIT="${HOME}/.hammerspoon/init.lua"
INSTALLED_APP="/Applications/Voice Input.app"
REMOVE_BREW=0

usage() {
  cat <<'EOF'
Usage: ./Uninstall [--with-brew]

Removes files created for this local voice-input setup:
- project files in "/Users/grigorymordokhovich/Documents/Develop/Voice input"
- Hammerspoon config "~/.hammerspoon/init.lua"

Optional:
  --with-brew   Also uninstall ffmpeg, whisper-cpp, and hammerspoon cask.
EOF
}

for arg in "${@:-}"; do
  case "${arg}" in
    --with-brew)
      REMOVE_BREW=1
      ;;
    -h|--help)
      usage
      exit 0
      ;;
    *)
      echo "Unknown option: ${arg}" >&2
      usage
      exit 1
      ;;
  esac
done

echo "Removing Hammerspoon config: ${HAMMERSPOON_INIT}"
rm -f "${HAMMERSPOON_INIT}"

if [[ -d "${HOME}/.hammerspoon" ]]; then
  rmdir "${HOME}/.hammerspoon" 2>/dev/null || true
fi

echo "Removing installed app: ${INSTALLED_APP}"
rm -rf "${INSTALLED_APP}"

echo "Removing project directory: ${PROJECT_DIR}"
rm -rf "${PROJECT_DIR}"

if [[ "${REMOVE_BREW}" -eq 1 ]]; then
  if command -v brew >/dev/null 2>&1; then
    echo "Uninstalling brew packages: ffmpeg whisper-cpp hammerspoon"
    brew uninstall --formula ffmpeg whisper-cpp || true
    brew uninstall --cask hammerspoon || true
    echo "Cleaning Homebrew cache"
    brew cleanup || true
  else
    echo "brew not found, skipped brew uninstall"
  fi
fi

echo "Uninstall complete."
